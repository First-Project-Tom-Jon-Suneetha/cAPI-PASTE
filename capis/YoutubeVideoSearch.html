<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="https://bootswatch.com/4/flatly/bootstrap.min.css" crossorigin="anonymous"> -->
    <link rel="stylesheet" type="text/css" href="../style.css">

<style type="text/css">
<style>

</style>
<style type="text/css">
    #website-preview {
        padding: 10px;
    }
    form {
      margin-bottom: 10px;
    }
</style>
</head>

<body>

<nav class="navbar" id="importHeader">
</nav>

<div class="wrapper" id="importInfoContainer">

<div class="container info-container">
    <div class="row remove-margin small-bottom-margin">
        <img class="user-icon" id="user-icon-change" src="http://via.placeholder.com/350x150">
        <h4><span id="pageTitle-change"></span><br><small><span id="APIType-change"></span> API Snippet by <a id="username-change" href="#" title="JonP Profile">JonP</a></small>
        </h4>
    </div>
    <div id="append-tags" class="row remove-margin small-bottom-margin">
    </div>
    <div class="row remove-margin">
        <button id="preview-button" class="myButton">Preview</button>
        <button id="html-button" class="myButton">HTML</button>
        <button id="css-button" class="myButton">CSS</button>
        <button id="js-button" class="myButton">JS</button>
    </div>
</div>

<div class="container playground">

    <div class="website-preview-container">
        <div id="website-preview">
            <form>
                Search Youtube: 
                <br>
                <input type="text" id="searchInput" value="Cute Kittens">
                <br>
                <input type="submit" id="submitSearchInput" value="Submit">
            </form>
            <div>
                <ul id="videos" style="list-style: none; padding-left: 0;">
                </ul>
            </div>
        </div>
    </div>

    <div id="editor-html"></div>

    <div id="editor-css"></div>

    <div id="editor-javascript"></div>

</div>

<div class="container panelplayground" id="additional-instructions">
    <h3 class="remove-margin similar-capis">Additional Instructions:</h3>
    <p class="remove-margin">You'll need to get your own API key. Follow the instructions <a href="https://google-developers.appspot.com/maps/documentation/embed/get-api-key" target="_blank" class="additionallink">HERE!</a>
    <br>
    After you get your API Key, insert it into the APIKey variable in the javascript
    <br>
    You can adjust the maximumResults variable (up to 50). This works by searching for a match in the youtuber's channel name and returns the most recent uploads by that youtuber.
    </p>
</div>

<div class="container panelplayground">
    <h3 class="remove-margin similar-capis">Similar cAPIs:</h3>
    <div class="row">
        <div id="similar1" class="col-xs-3"></div>
        <div id="similar2" class="col-xs-3"></div>
        <div id="similar3" class="col-xs-3"></div>
        <div id="similar4" class="col-xs-3"></div>              
    </div>
</div>

<div class="push"></div>

<footer id="importFooter" class="footer"></footer>
</body>

<script src="https://www.gstatic.com/firebasejs/4.8.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAoBqOGpNhrH9ba5arV455T2kzhsT3bZHw",
    authDomain: "capi-paste.firebaseapp.com",
    databaseURL: "https://capi-paste.firebaseio.com",
    projectId: "capi-paste",
    storageBucket: "capi-paste.appspot.com",
    messagingSenderId: "1002672238599"
  };
  firebase.initializeApp(config);
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="../scripts/importheaderfooter.js"></script>
<script src="../ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">

pageTitle = 'Youtube Video Search';
pageURL = 'YoutubeVideoSearch.html';
APIType = 'Youtube Data API v3';
tags = ['Youtube', 'data api', 'video', 'html', 'css', 'javascript'];
submitter = 'JonP';
preview = '/pageimages/YoutubeVideoSearch.png';
// apiKey = 'AIzaSyC--CEK0kKhGRihm9BRqcy4mW5UeV_Nk3w';

dbUsers = firebase.database().ref('/userdata');
dbCurrentUser = firebase.database().ref('/userdata/' +submitter);

dbPages = firebase.database().ref('/pagedata');
dbCurrentPage = firebase.database().ref('/pagedata/' +pageTitle);

function newUser(){
    dbCurrentUser.set({
        "Name": submitter,
        "Password": "poop",
        "Avatar": "image.url"
    })
}
newUser();

dbUsers.on('value', snap=>{
    console.log(snap.val());
})

function updatePage(){
    dbCurrentPage.set({
        Name: pageTitle,
        URL: pageURL,
        previewURL: preview,
        API: APIType,
        Tags: tags,
        submittedBy: submitter,
        APIKey: apiKey
    })
}
// updatePage();

appendNo = 1;

dbPages.on('child_added', snap=>{
    // tempArray = snap.val();
    console.log(snap.val());
    if(tags[0] == snap.val().Tags[0] && appendNo < 5 && pageTitle != snap.val().Name){
        $('#similar'+appendNo).append('<a href="'+snap.val().URL+'"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">'+snap.val().Name+'</h3></div><div class="panel-body"><img class="imgWidth" src="..'+snap.val().previewURL+'"></div></div></a>');
        appendNo++;
    }
})

dbUsers.on('child_added', snap=>{
// console.log(snap.val().username);
    if(submitter == snap.val().username){
        $('#user-icon-change').attr('src', '..'+snap.val().img);
    }
})
</script>
<!-- Page Specific JS -->
<script>
var searchQuery = 'Cute Kittens';
var maximumResults = 10;
var videoWidth =  480;
var videoHeight = videoWidth*3/4;
var APIKey = 'AIzaSyC--CEK0kKhGRihm9BRqcy4mW5UeV_Nk3w'

$('#submitSearchInput').click(function(){
  event.preventDefault();
  $('#videos').empty();
  searchQuery = $('#searchInput').val()
  getVideos(searchQuery, APIKey);
})

function getVideos(searchQuery, APIKey){
  $.get(
    "https://www.googleapis.com/youtube/v3/search",{
      part:'snippet',
      type: 'video',
      maxResults: maximumResults,
      q: searchQuery,
      key: APIKey
    },
    function(data){
      console.log(data);
      if(data.items.length>0){
        $.each(data.items, function(i, item){
          videoID = item.id.videoId;
          output = '<li><iframe height="'+videoHeight+'" width="'+videoWidth+'" src=\"//www.youtube.com/embed/'+videoID+'\"></iframe></li>'
          $('#videos').append(output);
        })
      }
      else{
        var output = '<li>'+searchQuery+' returned no results</li>'
        $('#videos').append(output);
      }
    }
  );
}

getVideos(searchQuery, APIKey);

// dbCurrentPage.on('value', snap=>{
//   var APIKey = snap.val().APIKey;
//   getVideos(searchQuery, APIKey);
// });

</script>

<script src="../scripts/capis.js"></script>
<script src="../auth.js"></script>
</html>